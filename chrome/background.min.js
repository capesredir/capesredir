var automaticUrlOld;function _automaticToogle(state,save){var text=state?"Ativado":"Desativado";modoauto=state;_automaticSetListenerRedirect();_contextAutoUpdate();_msg("Redirecionamento automático "+text);if(typeof save!="undefined")chrome.storage.local.set({CAPESmodoauto:state})}function _automaticInitDomains(){chrome.storage.sync.get("domainsLocal",_optionsGetLocalDomains);chrome.storage.sync.get("domainsRejected",_optionsGetRejectedDomains)}function _automaticSetListenerRedirect(){chrome.webRequest.onBeforeRequest.removeListener(_automaticRedirectTo);chrome.webRequest.onCompleted.removeListener(_automaticCompleted);chrome.webRequest.onCompleted.addListener(_automaticCompleted,{urls:domains,types:["main_frame"]},["responseHeaders"]);if(modoauto){chrome.webRequest.onBeforeRequest.addListener(_automaticRedirectTo,{urls:domains,types:["main_frame"]},["blocking"])}}function _automaticCompleted(details){var statusCode=details.statusCode;var url=details.url.getCapes();var urlFromRequest=details.url;var tabId=details.tabId;var urlClear=details.url;var urlIsHttps=details.url.split("://")[0]=="https";var noConection=statusCode==404;var okStatus=statusCode==200;console.log(statusCode);function _goesToHttp(){chrome.tabs.update(tabId,{url:urlFromRequest.replace("https","http")})}function _addBlackList(url){_optionsResponse({domain:url.domain().result,valid:true,domainType:"reject",type:"newdomain"});chrome.tabs.update(tabId,{url:automaticUrlOld})}if(noConection)return;if(modoauto){if(url.inHome){_msg("Você está em casa",4);_automaticToogle(false);urlClear=automaticUrlOld;chrome.tabs.update(tabId,{url:urlClear})}else if(url.isBlocked&&okStatus){console.info("bloqueada");function _changeTab(){if(url.urlClear.indexOf("https://")==0){console.log("update tab");console.log(details.url);chrome.tabs.update(tabId,{url:details.url.replace("https://","http://")})}else{_optionsResponse({domain:url.domain,valid:url.valid,domainType:"reject",type:"newdomain"});_optionsResponse({domain:url.domain.replace("http://","https://"),valid:url.valid,domainType:"reject",type:"newdomain"});chrome.tabs.update(tabId,{url:url.urlClear})}}console.log("tab ainda não registrada, aguardando");var interval=setInterval(function(){console.log("chamado interval");chrome.tabs.get(tabId,function(){if(!chrome.runtime.lastError){console.log("limpado Interval");_changeTab();clearInterval(interval)}})},500)}else if(url.isRedirected&&!okStatus){function _askForReject(id,changeInfo,tab){if(changeInfo.status=="complete"&&id==tabId){chrome.tabs.sendMessage(tabId,{type:"openConfirm",text:"Aperte Ok para adicionar o domínio na lista de rejeitados",url:url.urlClear,askToGoHttp:urlIsHttps},function(response){if(typeof response=="undefined")return;if(response.goesToHttp){_goesToHttp()}else if(response.url){_addBlackList(response.url)}chrome.tabs.onUpdated.removeListener(_askForReject)})}}chrome.tabs.onUpdated.addListener(_askForReject)}}else if(!url.allow){urlClear=url.urlClear;chrome.tabs.update(tabId,{url:urlClear})}}function _automaticRedirectTo(details){var isRedirect=regexIsRedirected.test(details.url);var isRequestMain=details.requestId!=lastRequestId;var isExcluded=domainsRejected.indexOf(details.url.domain().result)!=-1;if(isExcluded)return{cancel:false};if(isRequestMain&&!isRedirect){lastRequestId=details.requestId;_msg("Redirecionamento para o Portal de Periódicos CAPES ativo");automaticUrlOld=details.url;return{redirectUrl:""+pre+details.url+""}}return{cancel:false}}function _automaticInit(){function _automaticAfterGet(result){modoauto=isDefined(result)?result.CAPESmodoauto:true;_automaticInitDomains();_contextCreate()}chrome.storage.local.get("CAPESmodoauto",_automaticAfterGet)}var automaticUrlOld;function _automaticToogle(state,save){var text=state?"Ativado":"Desativado";modoauto=state;_automaticSetListenerRedirect();_contextAutoUpdate();_msg("Redirecionamento automático "+text);if(typeof save!="undefined")chrome.storage.local.set({CAPESmodoauto:state})}function _automaticInitDomains(){chrome.storage.sync.get("domainsLocal",_optionsGetLocalDomains);chrome.storage.sync.get("domainsRejected",_optionsGetRejectedDomains)}function _automaticSetListenerRedirect(){chrome.webRequest.onBeforeRequest.removeListener(_automaticRedirectTo);chrome.webRequest.onCompleted.removeListener(_automaticCompleted);chrome.webRequest.onCompleted.addListener(_automaticCompleted,{urls:domains,types:["main_frame"]},["responseHeaders"]);if(modoauto){chrome.webRequest.onBeforeRequest.addListener(_automaticRedirectTo,{urls:domains,types:["main_frame"]},["blocking"])}}function _automaticCompleted(details){var statusCode=details.statusCode;var url=details.url.getCapes();var urlFromRequest=details.url;var tabId=details.tabId;var urlClear=details.url;var urlIsHttps=details.url.split("://")[0]=="https";var noConection=statusCode==404;var okStatus=statusCode==200;console.log(statusCode);function _goesToHttp(){chrome.tabs.update(tabId,{url:urlFromRequest.replace("https","http")})}function _addBlackList(url){_optionsResponse({domain:url.domain().result,valid:true,domainType:"reject",type:"newdomain"});chrome.tabs.update(tabId,{url:automaticUrlOld})}if(noConection)return;if(modoauto){if(url.inHome){_msg("Você está em casa",4);_automaticToogle(false);urlClear=automaticUrlOld;chrome.tabs.update(tabId,{url:urlClear})}else if(url.isBlocked&&okStatus){console.info("bloqueada");function _changeTab(){if(url.urlClear.indexOf("https://")==0){console.log("update tab");console.log(details.url);chrome.tabs.update(tabId,{url:details.url.replace("https://","http://")})}else{_optionsResponse({domain:url.domain,valid:url.valid,domainType:"reject",type:"newdomain"});_optionsResponse({domain:url.domain.replace("http://","https://"),valid:url.valid,domainType:"reject",type:"newdomain"});chrome.tabs.update(tabId,{url:url.urlClear})}}console.log("tab ainda não registrada, aguardando");var interval=setInterval(function(){console.log("chamado interval");chrome.tabs.get(tabId,function(){if(!chrome.runtime.lastError){console.log("limpado Interval");_changeTab();clearInterval(interval)}})},500)}else if(url.isRedirected&&!okStatus){function _askForReject(id,changeInfo,tab){if(changeInfo.status=="complete"&&id==tabId){chrome.tabs.sendMessage(tabId,{type:"openConfirm",text:"Aperte Ok para adicionar o domínio na lista de rejeitados",url:url.urlClear,askToGoHttp:urlIsHttps},function(response){if(typeof response=="undefined")return;if(response.goesToHttp){_goesToHttp()}else if(response.url){_addBlackList(response.url)}chrome.tabs.onUpdated.removeListener(_askForReject)})}}chrome.tabs.onUpdated.addListener(_askForReject)}}else if(!url.allow){urlClear=url.urlClear;chrome.tabs.update(tabId,{url:urlClear})}}function _automaticRedirectTo(details){var isRedirect=regexIsRedirected.test(details.url);var isRequestMain=details.requestId!=lastRequestId;var isExcluded=domainsRejected.indexOf(details.url.domain().result)!=-1;if(isExcluded)return{cancel:false};if(isRequestMain&&!isRedirect){lastRequestId=details.requestId;_msg("Redirecionamento para o Portal de Periodicos CAPES ativo");automaticUrlOld=details.url;return{redirectUrl:""+pre+details.url+""}}return{cancel:false}}function _automaticInit(){function _automaticAfterGet(result){modoauto=isDefined(result)?result.CAPESmodoauto:true;_automaticInitDomains();_contextCreate()}chrome.storage.local.get("CAPESmodoauto",_automaticAfterGet)}var domainsCapes=["*://*.genome.org/*","*://*.the-aps.org/*","*://*.jwatch.org/*","*://*.nih.gov/*","*://*.endojournals.org/*","*://*.csa.com/*","*://*.jhu.edu/*","*://*.nature.com/*","*://*.nejm.org/*","*://*.genetics.org/*","*://*.oecd-ilibrary.org/*","*://*.gerontologyjournals.org/*","*://*.atypon-link.com/*","*://*.bmj.com/*","*://*.oxfordmusiconline.com/*","*://*.astm.org/*","*://*.ovid.com/*","*://*.acm.org/*","*://*.ebscohost.com/*","*://*.ebscohost.com/*","*://*.ulrichsweb.com/*","*://*.amsciepub.com/*","*://*.rcpsych.org/*","*://*.micromedexsolutions.com/*","*://*.researcherid.com/*","*://*.liebertonline.com/*","*://*.emis.de/*","*://*.umi.com/*","*://*.sciencemag.org/*","*://*.jstor.org/*","*://*.acs.org/*","*://*.kluweronline.com/*","*://*.ebscohost.com/*","*://*.ingentaconnect.com/*","*://*.cas.org/*","*://*.sagepub.com/*","*://*.jleukbio.org/*","*://*.sciverse.com/*","*://*.springer-ny.com/*","*://*.medicinanet.com.br/*","*://*.jopdentonline.org/*","*://*.ingenta.com/*","*://*.ingentaconnect.com/*","*://*.galegroup.com/*","*://*.jamanetwork.com/*","*://*.asnjournals.org/*","*://*.sagepub.com/*","*://*.aip.org/*","*://*.bvs-psi.org.br/*","*://*.hwwilsonweb.com/*","*://*.engineeringvillage.org/*","*://*.nutrition.org/*","*://*.mcponline.org/*","*://*.worldscientific.com/*","*://*.bridgesjournal.com/*","*://*.cambridge.org/*","*://*.ama-assn.org/*","*://*.nii.ac.jp/*","*://*.capes.gov.br/*","*://*.andrologyjournal.org/*","*://*.emeraldinsight.com/*","*://*.papersinvited.com/*","*://*.wiley.com/*","*://*.astm.org/*","*://*.edata-center.com/*","*://*.uaemex.mx/*","*://*.dukejournals.org/*","*://*.reaxys.com/*","*://*.netlibrary.com/*","*://*.ingentaconnect.com/*","*://*.engineeringvillage.com/*","*://*.scopus.com/*","*://*.sciencedirect.com/*","*://*.exlibrisgroup.com/*","*://*.oxfordjournals.org/*","*://*.molbiolcell.org/*","*://*.apa.org/*","*://*.geoscienceworld.org/*","*://*.sciencedirect.com/*","*://*.rsc.org/*","*://*.osapublishing.org/*","*://*.esapubs.org/*","*://*.annclinlabsci.org/*","*://*.capes.gov.br/*","*://*.proquestamericalatina.com.br/*","*://*.blackwell-synergy.com/*","*://*.capes.gov.br/*","*://*.bioone.org/*","*://*.atypon-link.com/*","*://*.fasebj.org/*","*://*.aspresolver.com/*","*://*.aps.org/*","*://*.joponline.org/*","*://*.ieee.org/*","*://*.oclc.org/*","*://*.ebscohost.com/*","*://*.bloojournal.org/*","*://*.fiz-karlsruhe.de/*","*://*.sciencedirect.com/*","*://*.cabi.org/*","*://*.annualreviews.org/*","*://*.abc-clio.com/*","*://*.aacnjournals.org/*","*://*.iop.org/*","*://*.magonlinelibrary.com/*","*://*.informs.org/*","*://*.chestnet.org/*","*://*.pediatricsupersite.com/*","*://*.jvdi.org/*","*://*.scijournals.org/*","*://*.sciencedirect.com/*","*://*.ams.org/*","*://*.karger.com/*","*://*.thieme-connect.com/*","*://*.eb.com/*","*://*.aappublications.org/*"];function _clickCheckInException(url){var exception=exceptions.filter(function(item){return url.indexOf(item.from)!=-1});return exception.length>0?exception[0]:false}function _clickRedirectCAPES(tab){var url=tab.url;var tabId=tab.id;var exception;var isInCapes=regexIsRedirected.test(url);exception=_clickCheckInException(url);url=exception?exception.to:""+pre+url+"";if(isInCapes){_msg("Você já está no sistema Portal de Periódicos CAPES");return}else{_msg("Redirecionando para o Portal de Periódicos CAPES");chrome.tabs.update(tabId,{url:url});return}}function _clickInit(){chrome.browserAction.onClicked.addListener(_clickRedirectCAPES)}function _clickCheckInException(url){var exception=exceptions.filter(function(item){return url.indexOf(item.from)!=-1});return exception.length>0?exception[0]:false}function _clickRedirectCAPES(tab){var url=tab.url;var tabId=tab.id;var exception;var isInCapes=regexIsRedirected.test(url);exception=_clickCheckInException(url);url=exception?exception.to:""+pre+url+"";if(isInCapes){_msg("Você já está no sistema Portal de Periodicos CAPES");return}else{_msg("Redirecionando para o Portal de Periodicos CAPES");chrome.tabs.update(tabId,{url:url});return}}function _clickInit(){chrome.browserAction.onClicked.addListener(_clickRedirectCAPES)}function _contextShowSobre(){chrome.tabs.create({url:chrome.extension.getURL("sobre.html")})}function _contextAutoText(){var text=modoauto?"Desativar":"Ativar";return text+" redirecionamento automático"}function _contextAutoMode(){_automaticToogle(!modoauto,"save")}function _contextAutoUpdate(){var texto=_contextAutoText();chrome.contextMenus.update("Auto",{title:texto})}function _updateTab(url){chrome.tabs.query({active:true,currentWindow:true},function(tabs){if(tabs.length==0)return true;chrome.tabs.update(tabs[0].id,{url:url})})}function _contextShowOptions(url){chrome.tabs.create({url:chrome.extension.getURL("options.html")})}function _contextAskForAddHostName(url,type){chrome.tabs.query({active:true,lastFocusedWindow:true},_sendMessage);function _sendMessage(tabs){if(tabs.length==0)return;var tabId=tabs[0].id;chrome.tabs.sendMessage(tabId,{type:"openConfirm",text:"Esse é o enderço correto? Verifique se é o endereço original do site.",url:url.urlClear},function(response){var urlUser=response.url;if(!urlUser)return;var newUrl=urlUser.getCapes();if(!newUrl.valid)return;var newUrlHostname=newUrl.hostname;_optionsResponse({domain:newUrl.domain,valid:true,domainType:type,type:"newdomain"});if(newUrl.domainSub){_optionsResponse({domain:newUrl.domainSub,valid:true,domainType:type,type:"newdomain"});newUrlHostname="www."+newUrlHostname}var urlClear=url.urlFull.replace(url.hostname,newUrlHostname);chrome.tabs.update(tabId,{url:urlClear})})}}function _contextAddHostNameClick(info){var url=info.pageUrl.getCapes();var isSlack=url.hostname.indexOf("-")!=-1;var isSizeOk=url.hostname.split(".").length>1;var isCapes=!url.hostname.indexOf(".periodicos.capes.gov.br")!=-1;var isBadUrl=isCapes&&isSlack||!isSizeOk;if(info.menuItemId=="add"||!isBadUrl){_contextAskForAddHostName(url,info.menuItemId)}else{chrome.tabs.create({url:chrome.extension.getURL("options.html?url=")+url.urlClear})}}function _contextCreate(){chrome.contextMenus.create({title:"Redirecionar este domínio automaticamente",id:"add",contexts:["all"],onclick:_contextAddHostNameClick});chrome.contextMenus.create({title:"Nunca redirecionar este domínio automaticamente",id:"reject",contexts:["all"],onclick:_contextAddHostNameClick});chrome.contextMenus.create({id:"separator1",type:"separator",contexts:["all"],onclick:_contextShowOptions});chrome.contextMenus.create({id:"Auto",title:_contextAutoText(),contexts:["all"],onclick:_contextAutoMode});chrome.contextMenus.create({title:"+Opções",contexts:["all"],onclick:_contextShowOptions});chrome.contextMenus.create({title:"Sobre",contexts:["all"],onclick:_contextShowSobre})}function _contextShowSobre(){chrome.tabs.create({url:chrome.extension.getURL("sobre.html")})}function _contextAutoText(){var text=modoauto?"Desativar":"Ativar";return text+" redirecionamento automático"}function _contextAutoMode(){_automaticToogle(!modoauto,"save")}function _contextAutoUpdate(){var texto=_contextAutoText();chrome.contextMenus.update("Auto",{title:texto})}function _updateTab(url){chrome.tabs.query({active:true,currentWindow:true},function(tabs){if(tabs.length==0)return true;chrome.tabs.update(tabs[0].id,{url:url})})}function _contextShowOptions(url){chrome.tabs.create({url:chrome.extension.getURL("options.html")})}function _contextAskForAddHostName(url,type){chrome.tabs.query({active:true,lastFocusedWindow:true},_sendMessage);function _sendMessage(tabs){if(tabs.length==0)return;var tabId=tabs[0].id;chrome.tabs.sendMessage(tabId,{type:"openConfirm",text:"Esse é o enderço correto? Verifique se é o endereço original do site",url:url.urlClear},function(response){var urlUser=response.url;if(!urlUser)return;var newUrl=urlUser.getCapes();if(!newUrl.valid)return;var newUrlHostname=newUrl.hostname;_optionsResponse({domain:newUrl.domain,valid:true,domainType:type,type:"newdomain"});if(newUrl.domainSub){_optionsResponse({domain:newUrl.domainSub,valid:true,domainType:type,type:"newdomain"});newUrlHostname="www."+newUrlHostname}var urlClear=url.urlFull.replace(url.hostname,newUrlHostname);chrome.tabs.update(tabId,{url:urlClear})})}}function _contextAddHostNameClick(info){var url=info.pageUrl.getCapes();var isSlack=url.hostname.indexOf("-")!=-1;var isSizeOk=url.hostname.split(".").length>1;var isCapes=!url.hostname.indexOf(".periodicos.capes.gov.br")!=-1;var isBadUrl=isCapes&&isSlack||!isSizeOk;if(info.menuItemId=="add"||!isBadUrl){_contextAskForAddHostName(url,info.menuItemId)}else{chrome.tabs.create({url:chrome.extension.getURL("options.html?url=")+url.urlClear})}}function _contextCreate(){chrome.contextMenus.create({title:"Redirecionar este dominio automaticamente",id:"add",contexts:["all"],onclick:_contextAddHostNameClick});chrome.contextMenus.create({title:"Nunca redirecionar este dominio automaticamente",id:"reject",contexts:["all"],onclick:_contextAddHostNameClick});chrome.contextMenus.create({id:"separator1",type:"separator",contexts:["all"],onclick:_contextShowOptions});chrome.contextMenus.create({id:"Auto",title:_contextAutoText(),contexts:["all"],onclick:_contextAutoMode});chrome.contextMenus.create({title:"+Opções",contexts:["all"],onclick:_contextShowOptions});chrome.contextMenus.create({title:"Sobre",contexts:["all"],onclick:_contextShowSobre})}String.prototype.domain=function(){var domain;var a=document.createElement("a");a.href=this.valueOf();var itens=a.hostname.split(".");var nItens=itens.length;var protocol=a.href.split("://")[0];var domain=protocol+"://"+a.hostname+"/*";var domainSub=false;valid=true;if(itens.length<2){valid=false}else if(itens.length==2){var domainSub=protocol+"://www."+a.hostname+"/*"}return{result:domain,domain:domain,valid:valid,hostname:a.hostname,domainSub:domainSub}};String.prototype.getCapes=function(){var url=this;var ezNumber;var hostname=url.domain().hostname;var isNewWay=url.indexOf("://www.periodicos.capes.gov.br/")!=-1;var isRedirected=regexIsRedirected.test(hostname);var isBlocked=regexIsBlocked.test(url);var allow=false;var inHome=false;var urlFull;var elementsUrl;if(isRedirected){ezNumber=String(hostname.split(regexIsRedirected)[2]);urlFull=url.split(".ez"+ezNumber+".periodicos.capes.gov.br").reduce(function(a,b){return a+b});url=url.split(".ez"+ezNumber+".periodicos.capes.gov.br")[0];allow=true}else if(isBlocked){url=url.split("&url=")[1];urlFull=url}else if(isNewWay){inHome=true;allow=true}else{url=url.valueOf();urlFull=url;allow=true}elementsUrl=url.domain();return{domain:elementsUrl.domain,valid:elementsUrl.valid,hostname:elementsUrl.hostname,domainSub:elementsUrl.domainSub,urlClear:url,urlFull:urlFull,isBlocked:isBlocked,isRedirected:isRedirected,allow:allow,inHome:inHome}};function isDefined(test){return JSON.stringify(test)!="{}"}if(typeof chrome.storage.sync=="undefined")chrome.storage.sync=chrome.storage.local;var lastRequestId;var domains=[];var domainsLocal=[];var domainsRejected=["http://login.webofknowledge.com/*","https://login.webofknowledge.com/*"];var modoauto=true;var showmsg=true;var pre="http://novo.periodicos.capes.gov.br/?option=com_pezproxy&controller=auth&view=pezproxyauth&url=";var regexIsRedirected=/^(.*?)\.ez+([0-9]{1,5})+.periodicos.capes.gov.br+(.*)/;var regexIsBlocked=/^(http|https)+\:+\/+\/+ez+([0-9]{1,5})+\.periodicos\.capes\.gov\.br\/+(login|connect)+\?+(.*)/;var exceptions=[{from:"http://login.webofknowledge.com",to:pre+"http://www.webofknowledge.com/"},{from:"https://login.webofknowledge.com",to:pre+"https://www.webofknowledge.com/"}];function isDefined(test){return JSON.stringify(test)!="{}"}if(typeof chrome.storage.sync=="undefined")chrome.storage.sync=chrome.storage.local;var lastRequestId;var domains=[];var domainsLocal=[];var domainsRejected=["*://physics.aps.org/*"];var modoauto=true;var showmsg=true;var pre="http://ez314.periodicos.capes.gov.br/login?url=";var extra="ez314.periodicos.capes.gov.br";var exceptions=[{from:"http://login.webofknowledge.com",to:"http://apps-webofknowledge.ez34.periodicos.capes.gov.br/"}];function _showInstallFirefox(result){var currentVer=isDefined(result)?result["currentVer"]:"0";if(currentVer!="3.1"){chrome.tabs.create({url:"http://www.infis.ufu.br/capes-periodicos"});chrome.storage.local.set({currentVer:"3.1"})}}function _showInstallChrome(details){if(details.reason=="update"){_optionsResponse({type:"removeAlldomainsLocal"});_automaticToogle(true,"save");chrome.tabs.create({url:chrome.extension.getURL("sobre.html?status=update")})}if(details.reason=="install"){chrome.tabs.create({url:chrome.extension.getURL("sobre.html?status=update")})}chrome.runtime.onInstalled.removeListener(_showInstallChrome)}function _installInit(){if(typeof chrome.runtime.onInstalled=="undefined"){chrome.storage.local.get("currentVer",_showInstallFirefox)}else{chrome.runtime.onInstalled.addListener(_showInstallChrome)}}function _msgToogle(state){showmsg=state;chrome.storage.local.set({CAPESshowmsg:showmsg})}function _msgOnOff(info,tab){showmsg=info.checked?true:false;_msgToogle(showmsg)}function _msg(msg,seconds){if(!showmsg)return;var uniqueId=String(Math.random());seconds=typeof seconds!="undefined"?seconds*1e3:2e3;chrome.notifications.create(uniqueId,{title:"Redirecionamento CAPES",iconUrl:"iconP128.png",type:"basic",message:msg},function(id){var timer=setTimeout(function(){chrome.notifications.clear(id)},seconds)})}function _msgInit(){function _msgAfterGet(result){showmsg=isDefined(result)?result.CAPESshowmsg:true}chrome.storage.local.get("CAPESshowmsg",_msgAfterGet)}function _optionsGetLocalDomains(result){domainsLocal=isDefined(result)?result["domainsLocal"]:domainsLocal;_optionsInit();_automaticSetListenerRedirect()}function _optionsGetRejectedDomains(result){domainsRejected=isDefined(result)?result["domainsRejected"]:domainsRejected}function _optionsResponse(request,sender,sendResponse){if(request.type=="newdomain"){if(request.domainType=="add"&&request.valid){_optionAddLocalDomain(request.domain)}else if(request.valid){_optionAddRejectedDomain(request.domain)}if(typeof sendResponse!="undefined")sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}else if(request.type=="removeAlldomainsLocal"){domainsLocal=[];domainsRejected=[];_optionsUpdateStorage(domainsLocal);_optionsUpdateStorage(domainsRejected);if(typeof sendResponse!="undefined"){sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}}else if(request.type=="getdomainsLocal"){sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}else if(request.type=="getConfig"){sendResponse({modoauto:this.modoauto,showmsg:this.showmsg})}else if(request.type=="saveConfigModo"){this._automaticToogle(request.modoauto,"save");sendResponse({})}else if(request.type=="saveConfigMsg"){this._msgToogle(request.showmsg);sendResponse({})}else if(request.type=="removeIndex"){if(request.domainType=="add"){domainsLocal.splice(request.removeIndex,1);_optionsUpdateStorage(domainsLocal)}else{domainsRejected.splice(request.removeIndex,1);_optionsUpdateStorageRejected(domainsRejected)}sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}}function _optionAddRejectedDomain(domainReject){var indexWhiteList=domainsLocal.indexOf(domainReject);var isInWhiteList=indexWhiteList!=-1;var indexBlackList=domainsRejected.indexOf(domainReject);var isInBlackList=indexBlackList!=-1;if(isInWhiteList){_msg("Domínio removido da whitelist",3);domainsLocal.splice(indexWhiteList,1);_optionsUpdateStorage(domainsLocal)}if(!isInBlackList){_msg("Domínio adicionado à blacklist",3);domainsRejected.push(domainReject);_optionsUpdateStorageRejected(domainsRejected)}}function _optionAddLocalDomain(domainLocal){var indexWhiteList=domainsLocal.indexOf(domainLocal);var isInWhiteList=indexWhiteList!=-1;var indexBlackList=domainsRejected.indexOf(domainLocal);var isInBlackList=indexBlackList!=-1;if(!isInWhiteList){_msg("Domínio adicionado à whitelist",3);domainsLocal.push(domainLocal);_optionsUpdateStorage(domainsLocal)}if(isInBlackList){_msg("Domínio removido da blacklist",3);domainsRejected.splice(indexBlackList,1);_optionsUpdateStorageRejected(domainsRejected)}}function _optionsInit(){domains=domainsCapes.concat(domainsLocal);chrome.runtime.onMessage.addListener(_optionsResponse)}function _optionsUpdateStorage(domainsLocal){domains=domainsCapes.concat(domainsLocal);_automaticSetListenerRedirect(modoauto);chrome.storage.sync.set({domainsLocal:domainsLocal});chrome.storage.local.set({domainsLocal:domainsLocal})}function _optionsUpdateStorageRejected(domainsRejected){chrome.storage.sync.set({domainsRejected:domainsRejected});chrome.storage.local.set({domainsRejected:domainsRejected})}function _optionsGetLocalDomains(result){domainsLocal=isDefined(result)?result["domainsLocal"]:domainsLocal;_optionsInit();_automaticSetListenerRedirect()}function _optionsGetRejectedDomains(result){domainsRejected=isDefined(result)?result["domainsRejected"]:domainsRejected}function _optionsResponse(request,sender,sendResponse){if(request.type=="newdomain"){if(request.domainType=="add"&&request.valid){_optionAddLocalDomain(request.domain)}else if(request.valid){_optionAddRejectedDomain(request.domain)}if(typeof sendResponse!="undefined")sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}else if(request.type=="removeAlldomainsLocal"){domainsLocal=[];domainsRejected=[];_optionsUpdateStorage(domainsLocal);_optionsUpdateStorage(domainsRejected);if(typeof sendResponse!="undefined"){sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}}else if(request.type=="getdomainsLocal"){sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}else if(request.type=="getConfig"){sendResponse({modoauto:this.modoauto,showmsg:this.showmsg})}else if(request.type=="saveConfigModo"){this._automaticToogle(request.modoauto,"save");sendResponse({})}else if(request.type=="saveConfigMsg"){this._msgToogle(request.showmsg);sendResponse({})}else if(request.type=="removeIndex"){if(request.domainType=="add"){domainsLocal.splice(request.removeIndex,1);_optionsUpdateStorage(domainsLocal)}else{domainsRejected.splice(request.removeIndex,1);_optionsUpdateStorageRejected(domainsRejected)}sendResponse({domainsRejected:this.domainsRejected,domainsLocal:this.domainsLocal})}}function _optionAddRejectedDomain(domainReject){var indexWhiteList=domainsLocal.indexOf(domainReject);var isInWhiteList=indexWhiteList!=-1;var indexBlackList=domainsRejected.indexOf(domainReject);var isInBlackList=indexBlackList!=-1;if(isInWhiteList){_msg("Domínio removido da whitelist",3);domainsLocal.splice(indexWhiteList,1);_optionsUpdateStorage(domainsLocal)}if(!isInBlackList){_msg("Domínio adicionado à blacklist",3);domainsRejected.push(domainReject);_optionsUpdateStorageRejected(domainsRejected)}}function _optionAddLocalDomain(domainLocal){var indexWhiteList=domainsLocal.indexOf(domainLocal);var isInWhiteList=indexWhiteList!=-1;var indexBlackList=domainsRejected.indexOf(domainLocal);var isInBlackList=indexBlackList!=-1;if(!isInWhiteList){_msg("Domínio Adicionado a Whitelist",3);domainsLocal.push(domainLocal);_optionsUpdateStorage(domainsLocal)}if(isInBlackList){_msg("Domínio Removido da Blacklist",3);domainsRejected.splice(indexBlackList,1);_optionsUpdateStorageRejected(domainsRejected)}}function _optionsInit(){domains=domainsCapes.concat(domainsLocal);chrome.runtime.onMessage.addListener(_optionsResponse)}function _optionsUpdateStorage(domainsLocal){domains=domainsCapes.concat(domainsLocal);_automaticSetListenerRedirect(modoauto);chrome.storage.sync.set({domainsLocal:domainsLocal});chrome.storage.local.set({domainsLocal:domainsLocal})}function _optionsUpdateStorageRejected(domainsRejected){chrome.storage.sync.set({domainsRejected:domainsRejected});chrome.storage.local.set({domainsRejected:domainsRejected})}function main(){_clickInit();_automaticInit();_msgInit();_installInit()}main();